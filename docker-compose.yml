version: "3"

services:
  # application Flask server
  server:
    container_name: mender_www
    env_file: .env
    restart: unless-stopped

    expose:
      - "5000"

    build:
      context: .
      dockerfile: Dockerfile

    logging:
      driver: "json-file"
      options:
        max-size: "100k"
        max-file: "10"


  # reverse-proxy NGINX server
  web:
    image: "nginx"
    container_name: mender_nginx
    restart: on-failure

    logging:
      driver: "json-file"
      options:
        max-size: "100k"
        max-file: "10"

    ports:
      - "8080:80"

    volumes:
      - ./conf/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./conf/mime.types:/etc/nginx/mime.types:ro
      - ./conf/proxy.conf:/etc/nginx/proxy.conf:ro
