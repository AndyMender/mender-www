services:
  # application Flask server
  app:
    container_name: mender_www
    restart: unless-stopped

    build:
      context: .
      dockerfile: Dockerfile

    logging:
      driver: "json-file"
      options:
        max-size: "100k"
        max-file: "10"
    
    # NOTE: The port mapping is needed only when the app is directly exposed outside the docker 'default' network.
    # ports:
    #   - "8000:8000"

  # reverse-proxy NGINX server
  web:
    image: "nginx:1.29"
    container_name: mender_nginx
    restart: on-failure
    
    # NOTE: Places both containers in the same network
    links:
      - app
      
    depends_on:
      - app

    logging:
      driver: "json-file"
      options:
        max-size: "100k"
        max-file: "10"

    ports:
      - "80:80"
      - "443:443"

    volumes:
      # Keep logs outside of Docker
      - ./logs/nginx:/var/log/nginx
      - ./conf/nginx.conf:/etc/nginx/nginx.conf:ro
